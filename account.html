<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>帳號狀態 - 韓文學習網</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .section-title {
      margin-top: 30px;
    }
    .badge-status {
      font-size: 0.95rem;
    }
  </style>
</head>
<body class="bg-light">
  <!-- 導覽列 -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
    <a class="navbar-brand" href="fp.html">韓文學習網</a>
  </nav>

  <div class="container py-5">
    <h2 class="text-center mb-4">帳號狀態</h2>

    <!-- 使用者資訊 -->
    <div class="mb-4">
      <h5>登入帳號：<span id="userEmail">載入中...</span></h5>
    </div>

    <!-- 學習進度 -->
    <div class="section-title">
      <h4>📘 學習進度</h4>
      <ul class="list-group" id="progressList">
        <!-- 動態插入單元進度 -->
      </ul>
    </div>

    <!-- 測驗徽章 -->
    <div class="section-title">
      <h4>🏅 測驗結果徽章</h4>
      <div id="badgeGrid" class="row g-3">
        <!-- 動態插入徽章卡片 -->
      </div>
    </div>
  </div>

  <!-- Firebase 資料取得 -->
  <script type="module">
    import { auth } from './firebase-init.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    const db = getFirestore();

    onAuthStateChanged(auth, async (user) => {
      const emailDisplay = document.getElementById("userEmail");
      const progressList = document.getElementById("progressList");
      const badgeGrid = document.getElementById("badgeGrid");

      if (user) {
        emailDisplay.textContent = user.email;
        const uid = user.uid;
        const userRef = doc(db, "users", uid);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          // 顯示學習進度
          const progress = data.progress || {};
          const units = [
            "單母音", "複合母音", "單子音", "複合子音",
            "單字一", "單字二", "單字三", "單字四", "單字五"
          ];

          units.forEach(unit => {
            const status = progress[unit] || "未學習";
            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
              ${unit}
              <span class="badge bg-${status === '已完成' ? 'success' : (status === '未完成' ? 'warning text-dark' : 'secondary')} badge-status">
                ${status}
              </span>
            `;
            progressList.appendChild(li);
          });

          // 顯示測驗徽章
          const badges = data.badges || [];
          units.forEach(unit => {
            const passed = badges.includes(unit);
            const col = document.createElement("div");
            col.className = "col-md-4 col-sm-6";
            col.innerHTML = `
              <div class="card text-center border-${passed ? 'success' : 'secondary'}">
                <div class="card-body">
                  <h6 class="card-title">${unit}</h6>
                  <p class="card-text">
                    ${passed ? '✅ 測驗通過' : '❌ 尚未通過'}
                  </p>
                </div>
              </div>
            `;
            badgeGrid.appendChild(col);
          });
        } else {
          emailDisplay.textContent += "（未找到資料）";
        }
      } else {
        emailDisplay.textContent = "尚未登入";
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>