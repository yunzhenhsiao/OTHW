<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¸³è™Ÿç‹€æ…‹ - éŸ“æ–‡å­¸ç¿’ç¶²</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .section-title {
      margin-top: 30px;
    }
    .badge-status {
      font-size: 0.95rem;
    }
  </style>
</head>
<body class="bg-light">
  <!-- å°è¦½åˆ— -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
    <a class="navbar-brand" href="fp.html">éŸ“æ–‡å­¸ç¿’ç¶²</a>
  </nav>

  <div class="container py-5">
    <h2 class="text-center mb-4">å¸³è™Ÿç‹€æ…‹</h2>

    <!-- ä½¿ç”¨è€…è³‡è¨Š -->
    <div class="mb-4">
      <h5>ç™»å…¥å¸³è™Ÿï¼š<span id="userEmail">è¼‰å…¥ä¸­...</span></h5>
    </div>

    <!-- å­¸ç¿’é€²åº¦ -->
    <div class="section-title">
      <h4>ğŸ“˜ å­¸ç¿’é€²åº¦</h4>
      <ul class="list-group" id="progressList">
        <!-- å‹•æ…‹æ’å…¥å–®å…ƒé€²åº¦ -->
      </ul>
    </div>

    <!-- æ¸¬é©—å¾½ç«  -->
    <div class="section-title">
      <h4>ğŸ… æ¸¬é©—çµæœå¾½ç« </h4>
      <div id="badgeGrid" class="row g-3">
        <!-- å‹•æ…‹æ’å…¥å¾½ç« å¡ç‰‡ -->
      </div>
    </div>
  </div>

  <!-- Firebase è³‡æ–™å–å¾— -->
  <script type="module">
    import { auth } from './firebase-init.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    const db = getFirestore();

    onAuthStateChanged(auth, async (user) => {
      const emailDisplay = document.getElementById("userEmail");
      const progressList = document.getElementById("progressList");
      const badgeGrid = document.getElementById("badgeGrid");

      if (user) {
        emailDisplay.textContent = user.email;
        const uid = user.uid;
        const userRef = doc(db, "users", uid);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          // é¡¯ç¤ºå­¸ç¿’é€²åº¦
          const progress = data.progress || {};
          const units = [
            "å–®æ¯éŸ³", "è¤‡åˆæ¯éŸ³", "å–®å­éŸ³", "è¤‡åˆå­éŸ³",
            "å–®å­—ä¸€", "å–®å­—äºŒ", "å–®å­—ä¸‰", "å–®å­—å››", "å–®å­—äº”"
          ];

          units.forEach(unit => {
            const status = progress[unit] || "æœªå­¸ç¿’";
            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
              ${unit}
              <span class="badge bg-${status === 'å·²å®Œæˆ' ? 'success' : (status === 'æœªå®Œæˆ' ? 'warning text-dark' : 'secondary')} badge-status">
                ${status}
              </span>
            `;
            progressList.appendChild(li);
          });

          // é¡¯ç¤ºæ¸¬é©—å¾½ç« 
          const badges = data.badges || [];
          units.forEach(unit => {
            const passed = badges.includes(unit);
            const col = document.createElement("div");
            col.className = "col-md-4 col-sm-6";
            col.innerHTML = `
              <div class="card text-center border-${passed ? 'success' : 'secondary'}">
                <div class="card-body">
                  <h6 class="card-title">${unit}</h6>
                  <p class="card-text">
                    ${passed ? 'âœ… æ¸¬é©—é€šé' : 'âŒ å°šæœªé€šé'}
                  </p>
                </div>
              </div>
            `;
            badgeGrid.appendChild(col);
          });
        } else {
          emailDisplay.textContent += "ï¼ˆæœªæ‰¾åˆ°è³‡æ–™ï¼‰";
        }
      } else {
        emailDisplay.textContent = "å°šæœªç™»å…¥";
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>